<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Tech Vibe - æ—¥ç¨‹è¦åŠƒ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#1a1a1a;color:#e0e0e0}
.header{background:#0d0d0d;color:#e0e0e0;padding:20px;text-align:center;border-bottom:1px solid #333}
.header h1{margin:0}
.main{display:flex;height:calc(100vh - 80px);margin-top:80px}
.left{width:320px;background:#1a1a1a;padding:16px;overflow-y:auto;border-right:1px solid #333}
.right{flex:1;background:#1a1a1a;display:flex;flex-direction:column}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin:16px 0}
button{padding:8px;border:1px solid #444;background:#2a2a2a;cursor:pointer;width:100%;margin:4px 0;border-radius:4px;transition:0.2s;color:#e0e0e0}
button:hover{border-color:#666;background:#333}
button.selected{background:#4a90e2;color:#fff;border-color:#4a90e2}
input,select,textarea{width:100%;padding:8px;margin:8px 0;border:1px solid #444;border-radius:4px;font-family:Arial;font-size:13px;background:#2a2a2a;color:#e0e0e0}
input:focus,select:focus,textarea:focus{outline:none;border-color:#4a90e2}
textarea{resize:vertical;min-height:60px}
.btn-add{background:#4a90e2;color:white;border:none!important}
.btn-add:hover{background:#357abd!important}
.schedule-head{padding:16px;border-bottom:1px solid #333}
.schedule{display:flex;flex:1;overflow:hidden}
.times{width:60px;background:#0d0d0d;border-right:1px solid #333;overflow-y:auto}
.time{height:30px;display:flex;align-items:center;justify-content:center;font-size:10px;border-bottom:1px solid #222;color:#888}
.grid{flex:1;position:relative;overflow-y:auto;background:linear-gradient(to bottom,#222 1px,transparent 1px);background-size:100% 30px}
.task{position:absolute;left:4px;right:4px;background:#4a90e2;color:white;padding:4px;border-radius:3px;font-size:12px;font-weight:600;cursor:grab;border:1px solid #357abd;overflow:hidden;display:flex;align-items:center;gap:6px;user-select:none;box-shadow:0 2px 4px rgba(0,0,0,0.5);transition:0.2s}
.task:hover{box-shadow:0 4px 8px rgba(0,0,0,0.7);background:#357abd}
.task.dragging{opacity:0.7;cursor:grabbing}
.task.completed{background:#2a5a2a;border-color:#1a3a1a;opacity:0.7}
.task.completed .task-info{text-decoration:line-through;opacity:0.8}
.task-checkbox{width:16px;height:16px;border:2px solid rgba(255,255,255,0.5);border-radius:3px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.task.completed .task-checkbox{background:#4caf50;border-color:#4caf50}
.task.completed .task-checkbox::after{content:'âœ“';color:white;font-size:12px;font-weight:bold}
.task-info{flex:1;overflow:hidden;display:flex;flex-direction:column}
.task-name{font-weight:600;white-space:nowrap;overflow:ellipsis}
.task-time{font-size:10px;opacity:0.9}
.task-memo{font-size:9px;opacity:0.8;white-space:nowrap;overflow:ellipsis}
.task-resize{width:100%;height:4px;background:rgba(255,255,255,0.3);cursor:ns-resize;position:absolute;bottom:0;left:0;right:0}
.task-resize:hover{background:rgba(255,255,255,0.6)}
.countdown-section{background:linear-gradient(135deg,#1a3a4a,#2a4a5a);border:1px solid #4a90e2;border-radius:8px;padding:16px;margin-bottom:16px;box-shadow:0 4px 12px rgba(74,144,226,0.2)}
.countdown-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.countdown-header h3{font-size:14px;font-weight:600;color:#4a90e2;margin:0}
.countdown-list{max-height:300px;overflow-y:auto}
.countdown-item{background:#2a2a2a;border:1px solid #444;border-radius:6px;padding:12px;margin-bottom:10px;transition:0.2s;position:relative}
.countdown-item:hover{border-color:#4a90e2;background:#333}
.countdown-delete-btn{position:absolute;top:6px;right:6px;background:none;border:none;color:#888;font-size:18px;cursor:pointer;width:24px;height:24px;padding:0;display:flex;align-items:center;justify-content:center;transition:0.2s}
.countdown-delete-btn:hover{color:#d9534f}
.countdown-title{font-size:13px;font-weight:600;color:#e0e0e0;margin-bottom:6px;padding-right:24px}
.countdown-days{font-size:24px;font-weight:700;color:#4a90e2;margin:6px 0;text-align:center}
.countdown-date{font-size:11px;color:#888;text-align:center}
.countdown-form{background:#2a2a2a;border:1px solid #444;border-radius:6px;padding:12px;margin-top:12px}
.countdown-form-title{font-size:12px;color:#aaa;font-weight:600;margin-bottom:8px}
.countdown-form input{margin-bottom:8px}
.countdown-form button{margin:0}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:1000;align-items:center;justify-content:center}
.modal.show{display:flex}
.modal-content{background:#2a2a2a;border-radius:8px;padding:24px;width:90%;max-width:400px;max-height:80vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.8);border:1px solid #444;color:#e0e0e0}
.modal-content h2{margin:0 0 16px 0;font-size:18px;color:#fff}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:12px;font-weight:600;color:#aaa;margin-bottom:4px}
.form-group input,.form-group textarea{width:100%}
.modal-buttons{display:flex;gap:8px;margin-top:24px}
.modal-buttons button{margin:0;flex:1}
.btn-save{background:#4a90e2;color:white;border:none!important}
.btn-save:hover{background:#357abd!important}
.btn-cancel{background:#2a2a2a;color:#e0e0e0;border:1px solid #444!important}
.btn-cancel:hover{background:#333!important}
.btn-delete{background:#d9534f;color:white;border:none!important;margin-top:16px}
.btn-delete:hover{background:#c9423f!important}
.celebrate{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#2a5a2a;border:2px solid #4caf50;border-radius:16px;padding:40px;text-align:center;z-index:2000;box-shadow:0 20px 60px rgba(0,0,0,0.9);animation:celebrateIn 0.5s ease-out;min-width:300px}
.celebrate.show{display:block}
.celebrate h2{color:#4caf50;font-size:32px;margin-bottom:16px}
.celebrate p{color:#aaa;font-size:16px;margin-bottom:24px}
.celebrate .emoji{font-size:48px;margin-bottom:16px}
.btn-celebrate{background:#4caf50;color:white;border:none;padding:12px 32px;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:0.2s}
.btn-celebrate:hover{background:#45a049}
@keyframes celebrateIn{0%{transform:translate(-50%,-50%) scale(0.5);opacity:0}100%{transform:translate(-50%,-50%) scale(1);opacity:1}}
@keyframes celebrate{0%{transform:rotate(0deg) scale(1)}25%{transform:rotate(-5deg) scale(1.1)}50%{transform:rotate(5deg) scale(1.1)}75%{transform:rotate(-5deg) scale(1.1)}100%{transform:rotate(0deg) scale(1)}}
h3{font-size:14px;margin-bottom:12px;color:#fff}
hr{border:none;border-top:1px solid #333;margin:16px 0}
</style>
</head>
<body>

<div class="header"><h1>Tech Vibe æ—¥ç¨‹è¦åŠƒå·¥å…·</h1></div>

<div class="main">
<div class="left">
<div class="countdown-section">
<div class="countdown-header">
<h3>ğŸ“… é‡å¤§å€’æ•¸</h3>
<button style="width:auto;padding:4px 8px;font-size:11px" onclick="toggleCountdownForm()">ï¼‹</button>
</div>
<div class="countdown-list" id="cdList"></div>
<div class="countdown-form" id="cdForm" style="display:none">
<div class="countdown-form-title">æ–°å¢å€’æ•¸äº‹ä»¶</div>
<input type="text" id="cdTitle" placeholder="äº‹ä»¶åç¨± (å¦‚ï¼šè·¨å¹´)">
<input type="date" id="cdDate">
<button class="btn-add" onclick="addCountdown()">æ–°å¢å€’æ•¸</button>
</div>
</div>

<hr>

<div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
<button onclick="pm()" style="width:40px;padding:6px">â†</button>
<span id="ml" style="font-weight:bold;flex:1;text-align:center;font-size:14px">æœˆä»½</span>
<button onclick="nm()" style="width:40px;padding:6px">â†’</button>
</div>
<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:8px;font-size:11px;font-weight:bold;text-align:center;color:#888">
<div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
</div>
<div id="cal" class="calendar"></div>
</div>

<hr>

<div>
<h3>æ–°å¢ä»»å‹™</h3>
<div class="form-group">
<label>ä»»å‹™åç¨±</label>
<input type="text" id="tn" placeholder="è¼¸å…¥ä»»å‹™åç¨±">
</div>
<div class="form-group">
<label>é–‹å§‹æ™‚é–“</label>
<select id="st"></select>
</div>
<div class="form-group">
<label>æ™‚é•·</label>
<select id="dur">
<option value="0.5">0.5å°æ™‚</option>
<option value="1">1å°æ™‚</option>
<option value="1.5">1.5å°æ™‚</option>
<option value="2" selected>2å°æ™‚</option>
<option value="3">3å°æ™‚</option>
<option value="4">4å°æ™‚</option>
</select>
</div>
<div class="form-group">
<label>å‚™è¨»</label>
<textarea id="memo" placeholder="è£œå……èªªæ˜ (å¯é¸)"></textarea>
</div>
<button class="btn-add" onclick="add()">æ–°å¢ä»»å‹™</button>
</div>
</div>

<div class="right">
<div class="schedule-head">
<h2 id="dl" style="margin:0;font-size:18px">ä»Šæ—¥</h2>
<p id="hl" style="margin:8px 0 0 0;font-size:13px;color:#888">è¦åŠƒ: 0å°æ™‚</p>
</div>

<div class="schedule">
<div id="tc" class="times"></div>
<div id="gc" class="grid"></div>
</div>
</div>
</div>

<div class="modal" id="modal">
<div class="modal-content">
<h2>ç·¨è¼¯ä»»å‹™</h2>
<div class="form-group">
<label>ä»»å‹™åç¨±</label>
<input type="text" id="editName">
</div>
<div class="form-group">
<label>é–‹å§‹æ™‚é–“</label>
<select id="editTime"></select>
</div>
<div class="form-group">
<label>æ™‚é•·</label>
<select id="editDur">
<option value="0.5">0.5å°æ™‚</option>
<option value="1">1å°æ™‚</option>
<option value="1.5">1.5å°æ™‚</option>
<option value="2">2å°æ™‚</option>
<option value="3">3å°æ™‚</option>
<option value="4">4å°æ™‚</option>
</select>
</div>
<div class="form-group">
<label>å‚™è¨»</label>
<textarea id="editMemo" style="min-height:80px"></textarea>
</div>
<div class="modal-buttons">
<button class="btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
<button class="btn-save" onclick="saveEdit()">ä¿å­˜</button>
</div>
<button class="btn-delete" onclick="deleteEdit()">åˆªé™¤ä»»å‹™</button>
</div>
</div>

<div class="celebrate" id="celebrate">
<div class="emoji">ğŸ‰</div>
<h2>æ­å–œå®Œæˆï¼</h2>
<p id="celebrateMsg">å¤ªæ£’äº†ï¼ç¹¼çºŒåŠ æ²¹ï¼</p>
<button class="btn-celebrate" onclick="closeCelebrate()">å¤ªå¥½äº†</button>
</div>

<script>
let tasks=[],countdowns=[],d=new Date(),editingId=null,dragData=null;

function init(){
  let s=localStorage.getItem('tasks');
  if(s)tasks=JSON.parse(s);
  let cd=localStorage.getItem('countdowns');
  if(cd)countdowns=JSON.parse(cd);
  initSt();
  initEditSt();
  ren();
  renderCountdowns();
  updateCountdowns();
  setInterval(updateCountdowns,60000);
}

function initSt(){
  let st=document.getElementById('st');
  for(let h=0;h<24;h++){
    for(let m=0;m<60;m+=30){
      let t=(h<10?'0':'')+h+':'+(m<10?'0':'')+m;
      let o=document.createElement('option');
      o.value=t;
      o.textContent=t;
      st.appendChild(o);
    }
  }
  st.value='09:00';
}

function initEditSt(){
  let st=document.getElementById('editTime');
  for(let h=0;h<24;h++){
    for(let m=0;m<60;m+=30){
      let t=(h<10?'0':'')+h+':'+(m<10?'0':'')+m;
      let o=document.createElement('option');
      o.value=t;
      o.textContent=t;
      st.appendChild(o);
    }
  }
}

function toggleCountdownForm(){
  let f=document.getElementById('cdForm');
  f.style.display=f.style.display==='none'?'block':'none';
}

function addCountdown(){
  let title=document.getElementById('cdTitle').value.trim();
  let date=document.getElementById('cdDate').value;
  if(!title||!date)return alert('è«‹è¼¸å…¥äº‹ä»¶åç¨±å’Œæ—¥æœŸ');
  countdowns.push({id:Date.now(),title:title,date:date});
  saveCountdowns();
  document.getElementById('cdTitle').value='';
  document.getElementById('cdDate').value='';
  document.getElementById('cdForm').style.display='none';
  renderCountdowns();
}

function deleteCountdown(id){
  if(!confirm('ç¢ºå®šåˆªé™¤?'))return;
  countdowns=countdowns.filter(x=>x.id!==id);
  saveCountdowns();
  renderCountdowns();
}

function renderCountdowns(){
  let list=document.getElementById('cdList');
  list.innerHTML='';
  countdowns.forEach(cd=>{
    let div=document.createElement('div');
    div.className='countdown-item';
    let days=Math.ceil((new Date(cd.date)-new Date())/(1000*60*60*24));
    let color=days<=0?'#d9534f':days<=7?'#ff9800':'#4a90e2';
    
    let deleteBtn=document.createElement('button');
    deleteBtn.className='countdown-delete-btn';
    deleteBtn.textContent='Ã—';
    deleteBtn.onclick=()=>deleteCountdown(cd.id);
    
    let title=document.createElement('div');
    title.className='countdown-title';
    title.textContent=cd.title;
    
    let date=document.createElement('div');
    date.className='countdown-date';
    date.textContent=cd.date;
    
    let days_div=document.createElement('div');
    days_div.className='countdown-days';
    days_div.style.color=color;
    days_div.textContent=Math.max(0,days);
    
    div.appendChild(deleteBtn);
    div.appendChild(title);
    div.appendChild(date);
    div.appendChild(days_div);
    list.appendChild(div);
  });
}

function updateCountdowns(){
  renderCountdowns();
}

function saveCountdowns(){
  localStorage.setItem('countdowns',JSON.stringify(countdowns));
}

function ren(){
  renm();rcal();rtime();rsch();
}

function renm(){
  document.getElementById('ml').textContent=d.getFullYear()+'å¹´'+(d.getMonth()+1)+'æœˆ';
}

function rcal(){
  let y=d.getFullYear(),m=d.getMonth(),f=new Date(y,m,1).getDay(),n=new Date(y,m+1,0).getDate();
  let c=document.getElementById('cal');
  c.innerHTML='';
  for(let i=0;i<f;i++){let e=document.createElement('div');c.appendChild(e);}
  for(let j=1;j<=n;j++){
    let b=document.createElement('button');
    b.textContent=j;
    let z=new Date(y,m,j).toISOString().split('T')[0];
    if(z===d.toISOString().split('T')[0])b.className='selected';
    b.onclick=()=>{d=new Date(y,m,j);ren();};
    c.appendChild(b);
  }
}

function rtime(){
  let c=document.getElementById('tc');
  c.innerHTML='';
  for(let h=0;h<24;h++){
    let e=document.createElement('div');
    e.className='time';
    e.textContent=(h<10?'0':'')+h+':00';
    c.appendChild(e);
    let e2=document.createElement('div');
    e2.className='time';
    c.appendChild(e2);
  }
}

function rsch(){
  let z=d.toISOString().split('T')[0];
  document.getElementById('dl').textContent=d.toLocaleDateString('zh-Hant',{year:'numeric',month:'long',day:'numeric',weekday:'long'});
  let ts=tasks.filter(x=>x.z===z);
  let h=ts.reduce((a,x)=>a+x.dur,0);
  document.getElementById('hl').textContent='è¦åŠƒ: '+h+'å°æ™‚';
  let g=document.getElementById('gc');
  g.innerHTML='';
  ts.forEach(x=>{
    let [hh,mm]=x.tm.split(':').map(Number);
    let tp=(hh*60+mm)/30*30;
    let ht=x.dur*30;
    let e=document.createElement('div');
    e.className='task'+(x.done?' completed':'');
    e.style.top=tp+'px';
    e.style.height=ht+'px';
    e.dataset.id=x.id;
    e.draggable=!x.done;
    
    let chk=document.createElement('div');
    chk.className='task-checkbox';
    chk.onclick=(ev)=>{ev.stopPropagation();toggleDone(x.id);};
    e.appendChild(chk);
    
    let info=document.createElement('div');
    info.className='task-info';
    
    let name=document.createElement('div');
    name.className='task-name';
    name.textContent=x.nm;
    info.appendChild(name);
    
    let time=document.createElement('div');
    time.className='task-time';
    time.textContent=x.tm+' - '+getEndTime(x.tm,x.dur);
    info.appendChild(time);
    
    if(x.m){
      let memo=document.createElement('div');
      memo.className='task-memo';
      memo.textContent=x.m;
      info.appendChild(memo);
    }
    
    e.appendChild(info);
    
    let resize=document.createElement('div');
    resize.className='task-resize';
    resize.onmousedown=(ev)=>{if(!x.done){ev.preventDefault();ev.stopPropagation();startResize(ev,x.id);};
    };
    e.appendChild(resize);
    
    e.addEventListener('dragstart',(ev)=>{dragData={id:x.id,sy:ev.clientY};e.classList.add('dragging');});
    e.addEventListener('dragend',()=>{e.classList.remove('dragging');dragData=null;});
    
    e.addEventListener('click',(ev)=>{if(ev.target===resize||ev.target===chk)return;openModal(x.id);});
    
    g.appendChild(e);
  });
  
  g.addEventListener('dragover',(ev)=>{ev.preventDefault();ev.dataTransfer.dropEffect='move';});
  g.addEventListener('drop',(ev)=>{
    ev.preventDefault();
    if(!dragData)return;
    let rect=g.getBoundingClientRect();
    let y=ev.clientY-rect.top+g.scrollTop;
    let slot=Math.round(y/30)*30;
    let mins=Math.floor(slot/30);
    let h=Math.floor(mins/2);
    let m=mins%2*30;
    let tm=(h<10?'0':'')+h+':'+(m<10?'0':'')+m;
    let t=tasks.find(x=>x.id===dragData.id);
    if(t){t.tm=tm;save();rsch();}
    dragData=null;
  });
}

function toggleDone(id){
  let t=tasks.find(x=>x.id===id);
  if(!t)return;
  t.done=!t.done;
  save();
  rsch();
  if(t.done){
    showCelebrate(t.nm);
  }
}

function showCelebrate(taskName){
  document.getElementById('celebrateMsg').textContent=`ã€Œ${taskName}ã€å·²å®Œæˆï¼`;
  document.getElementById('celebrate').classList.add('show','animate');
  setTimeout(()=>{
    document.getElementById('celebrate').classList.remove('animate');
  },1500);
}

function closeCelebrate(){
  document.getElementById('celebrate').classList.remove('show');
}

function startResize(e,id){
  e.preventDefault();
  e.stopPropagation();
  let t=tasks.find(x=>x.id===id);
  if(!t)return;
  let sy=e.clientY;
  let oh=t.dur;
  
  function move(ev){
    let dy=ev.clientY-sy;
    let nh=Math.max(0.5,Math.round((oh*60+dy)/30)*0.5);
    t.dur=nh;
    rsch();
  }
  
  function up(){
    save();
    document.removeEventListener('mousemove',move);
    document.removeEventListener('mouseup',up);
  }
  
  document.addEventListener('mousemove',move);
  document.addEventListener('mouseup',up);
}

function getEndTime(tm,dur){
  let [h,m]=tm.split(':').map(Number);
  let total=h*60+m+dur*60;
  let eh=Math.floor(total/60)%24;
  let em=total%60;
  return (eh<10?'0':'')+eh+':'+(em<10?'0':'')+em;
}

function openModal(id){
  editingId=id;
  let t=tasks.find(x=>x.id===id);
  if(!t)return;
  document.getElementById('editName').value=t.nm;
  document.getElementById('editTime').value=t.tm;
  document.getElementById('editDur').value=t.dur;
  document.getElementById('editMemo').value=t.m||'';
  document.getElementById('modal').classList.add('show');
}

function closeModal(){
  document.getElementById('modal').classList.remove('show');
  editingId=null;
}

function saveEdit(){
  if(!editingId)return;
  let t=tasks.find(x=>x.id===editingId);
  if(!t)return;
  t.nm=document.getElementById('editName').value;
  t.tm=document.getElementById('editTime').value;
  t.dur=parseFloat(document.getElementById('editDur').value);
  t.m=document.getElementById('editMemo').value;
  save();
  rsch();
  closeModal();
}

function deleteEdit(){
  if(!editingId)return;
  if(!confirm('ç¢ºå®šåˆªé™¤?'))return;
  tasks=tasks.filter(x=>x.id!==editingId);
  save();
  rsch();
  closeModal();
}

function add(){
  let n=document.getElementById('tn').value;
  if(!n)return alert('è¼¸å…¥åç¨±');
  let x={
    id:Date.now(),
    nm:n,
    z:d.toISOString().split('T')[0],
    tm:document.getElementById('st').value,
    dur:parseFloat(document.getElementById('dur').value),
    m:document.getElementById('memo').value,
    done:false
  };
  tasks.push(x);
  save();
  document.getElementById('tn').value='';
  document.getElementById('memo').value='';
  rsch();
}

function save(){
  localStorage.setItem('tasks',JSON.stringify(tasks));
}

function pm(){d.setMonth(d.getMonth()-1);ren();}
function nm(){d.setMonth(d.getMonth()+1);ren();}

document.addEventListener('click',(e)=>{
  if(e.target===document.getElementById('modal')){
    closeModal();
  }
});

window.addEventListener('load',init);
</script>

</body>
</html>

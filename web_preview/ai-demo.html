<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Tech Vibe - AI ä»»å‹™åˆ†è§£ç¤ºä¾‹</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#1a1a1a;color:#e0e0e0;padding:20px}
.container{max-width:800px;margin:0 auto;background:#2a2a2a;border-radius:8px;padding:24px;border:1px solid #444}
h1{color:#4a90e2;margin-bottom:24px;font-size:24px}
.section{margin-bottom:24px}
.section h2{font-size:16px;color:#fff;margin-bottom:12px;border-bottom:1px solid #444;padding-bottom:8px}
.form-group{margin-bottom:12px}
label{display:block;font-size:12px;color:#aaa;font-weight:600;margin-bottom:4px}
textarea,input{width:100%;padding:10px;background:#1a1a1a;border:1px solid #444;border-radius:4px;color:#e0e0e0;font-family:Arial;font-size:13px}
textarea:focus,input:focus{outline:none;border-color:#4a90e2}
textarea{resize:vertical;min-height:80px}
button{padding:10px 20px;background:#4a90e2;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:600;transition:0.2s;font-size:14px}
button:hover{background:#357abd}
button:disabled{background:#666;cursor:not-allowed;opacity:0.6}
.button-group{display:flex;gap:8px}
.button-group button{flex:1}
.status{padding:12px;border-radius:4px;margin-top:12px;display:none;font-size:13px}
.status.show{display:block}
.status.success{background:#2a5a2a;border:1px solid #4caf50;color:#4caf50}
.status.error{background:#5a2a2a;border:1px solid #d9534f;color:#d9534f}
.status.loading{background:#2a4a5a;border:1px solid #4a90e2;color:#4a90e2}
.output-box{background:#1a1a1a;border:1px solid #444;border-radius:4px;padding:12px;white-space:pre-wrap;word-break:break-word;font-size:12px;max-height:300px;overflow-y:auto}
.task-list{list-style:none}
.task-item{background:#1a1a1a;border:1px solid #444;border-radius:4px;padding:12px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
.task-info h3{font-size:13px;color:#e0e0e0;margin-bottom:4px}
.task-info p{font-size:11px;color:#888}
.task-duration{background:#4a90e2;color:white;padding:4px 12px;border-radius:4px;font-weight:600;font-size:12px}
.health-indicator{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;background:#2a2a2a;border-radius:4px;font-size:12px;margin-top:8px}
.health-dot{width:8px;height:8px;border-radius:50%;background:#888}
.health-dot.online{background:#4caf50}
.info-box{background:#1a3a4a;border:1px solid #4a90e2;border-radius:4px;padding:12px;margin-bottom:12px;font-size:12px;line-height:1.6}
.info-box strong{color:#4a90e2}
.loading-spinner{display:inline-block;width:16px;height:16px;border:2px solid #4a90e2;border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin-right:8px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div class="container">
<h1>ğŸ¤– Tech Vibe - AI ä»»å‹™åˆ†è§£ç¤ºä¾‹</h1>

<div class="section">
<h2>ç³»çµ±ç‹€æ…‹</h2>
<div class="health-indicator">
<div class="health-dot" id="healthDot"></div>
<span id="healthText">æª¢æŸ¥ä¸­...</span>
</div>
</div>

<div class="info-box">
<strong>â„¹ï¸ èªªæ˜ï¼š</strong><br>
æ­¤é é¢å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Hugging Face flan-t5-base æ¨¡å‹é€²è¡Œä»»å‹™åˆ†è§£ã€‚<br>
å¾Œç«¯ API éœ€è¦åœ¨ localhost:3000 é‹è¡Œã€‚è©³è¦‹ /backend/README.md
</div>

<div class="section">
<h2>1ï¸âƒ£ ä»»å‹™åˆ†è§£</h2>
<div class="form-group">
<label>è¼¸å…¥ä»»å‹™æè¿°ï¼š</label>
<textarea id="taskDescription" placeholder="ä¾‹å¦‚ï¼šæº–å‚™è·¨å¹´æ´¾å°ï¼Œé‚€è«‹æœ‹å‹ï¼Œä½ˆç½®å ´åœ°ï¼Œæº–å‚™é£Ÿç‰©å’Œé£²æ–™">æº–å‚™è·¨å¹´æ´¾å°ï¼Œé‚€è«‹æœ‹å‹ï¼Œä½ˆç½®å ´åœ°ï¼Œæº–å‚™é£Ÿç‰©å’Œé£²æ–™</textarea>
</div>
<div class="button-group">
<button id="decomposeBtn" onclick="decomposeTask()">åˆ†æä»»å‹™</button>
<button onclick="resetForm()">é‡ç½®</button>
</div>
<div class="status" id="status"></div>
</div>

<div class="section">
<h2>2ï¸âƒ£ AI åŸå§‹è¼¸å‡º</h2>
<div class="output-box" id="aiOutput">ï¼ˆç­‰å¾… AI åˆ†æ...ï¼‰</div>
</div>

<div class="section">
<h2>3ï¸âƒ£ è§£æå¾Œçš„ä»»å‹™åˆ—è¡¨</h2>
<ul class="task-list" id="taskList">
<li class="task-item"><p style="color:#888;margin:0">ï¼ˆåˆ†æå¾Œé¡¯ç¤ºä»»å‹™ï¼‰</p></li>
</ul>
</div>

<div class="section">
<h2>4ï¸âƒ£ å¿«é€Ÿæ“ä½œ</h2>
<button onclick="createTasksFromParsed()" id="createTasksBtn" style="width:100%;display:none">âœ… å‰µå»ºæ‰€æœ‰ä»»å‹™</button>
</div>

</div>

<script src="ai-integration.js"></script>
<script>
// å…¨å±€ç‹€æ…‹
let parsedTasks = [];

// åˆå§‹åŒ–
window.addEventListener('load', async () => {
  await checkBackendStatus();
});

// æª¢æŸ¥å¾Œç«¯ç‹€æ…‹
async function checkBackendStatus() {
  const isHealthy = await window.AIIntegration.checkBackendHealth();
  const dot = document.getElementById('healthDot');
  const text = document.getElementById('healthText');
  
  if (isHealthy) {
    dot.classList.add('online');
    text.textContent = 'âœ… å¾Œç«¯å·²é€£æ¥ (localhost:3000)';
  } else {
    dot.classList.remove('online');
    text.textContent = 'âŒ å¾Œç«¯æœªé€£æ¥ã€‚è«‹é‹è¡Œ: cd backend && npm start';
  }
}

// é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
function showStatus(message, type = 'loading') {
  const status = document.getElementById('status');
  status.textContent = message;
  status.className = `status show ${type}`;
}

// ä»»å‹™åˆ†è§£
async function decomposeTask() {
  const description = document.getElementById('taskDescription').value.trim();
  
  if (!description) {
    showStatus('è«‹è¼¸å…¥ä»»å‹™æè¿°', 'error');
    return;
  }

  const btn = document.getElementById('decomposeBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="loading-spinner"></span>åˆ†æä¸­...';

  try {
    showStatus('æ­£åœ¨èª¿ç”¨ AI API...', 'loading');

    // èª¿ç”¨å¾Œç«¯ API
    const result = await window.AIIntegration.callDecomposeAPI(description);

    if (result.status !== 'success') {
      showStatus(`âŒ éŒ¯èª¤: ${result.error}`, 'error');
      document.getElementById('aiOutput').textContent = result.error;
      document.getElementById('taskList').innerHTML = '<li class="task-item"><p style="color:#d9534f">ä»»å‹™åˆ†è§£å¤±æ•—</p></li>';
      return;
    }

    // é¡¯ç¤ºåŸå§‹è¼¸å‡º
    document.getElementById('aiOutput').textContent = result.data.output;
    showStatus('âœ… AI åˆ†æå®Œæˆï¼', 'success');

    // è§£æä»»å‹™
    parsedTasks = window.AIIntegration.parseAIOutput(result.data.output);

    if (parsedTasks.length === 0) {
      showStatus('âš ï¸ ç„¡æ³•å¾ AI å›æ‡‰ä¸­æå–ä»»å‹™ã€‚è«‹æª¢æŸ¥è¼¸å‡ºæ ¼å¼ã€‚', 'error');
      document.getElementById('taskList').innerHTML = '<li class="task-item"><p style="color:#ff9800">è§£æå¤±æ•—ï¼šç„¡æ³•è­˜åˆ¥ä»»å‹™æ ¼å¼</p></li>';
      return;
    }

    // é¡¯ç¤ºä»»å‹™åˆ—è¡¨
    renderTaskList();

    // é¡¯ç¤ºå‰µå»ºæŒ‰éˆ•
    document.getElementById('createTasksBtn').style.display = 'block';
    showStatus(`âœ… æˆåŠŸæå– ${parsedTasks.length} å€‹ä»»å‹™ï¼`, 'success');

  } catch (error) {
    showStatus(`âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`, 'error');
    console.error('è©³ç´°éŒ¯èª¤:', error);
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'åˆ†æä»»å‹™';
  }
}

// æ¸²æŸ“ä»»å‹™åˆ—è¡¨
function renderTaskList() {
  const taskList = document.getElementById('taskList');
  
  if (parsedTasks.length === 0) {
    taskList.innerHTML = '<li class="task-item"><p style="color:#888">ç„¡ä»»å‹™</p></li>';
    return;
  }

  taskList.innerHTML = parsedTasks.map((task, index) => `
    <li class="task-item">
      <div class="task-info">
        <h3>#${index + 1} ${task.name}</h3>
        <p>é è¨ˆæ™‚é–“</p>
      </div>
      <div class="task-duration">${task.duration}h</div>
    </li>
  `).join('');
}

// å‰µå»ºä»»å‹™ï¼ˆç¤ºä¾‹ï¼‰
async function createTasksFromParsed() {
  if (parsedTasks.length === 0) {
    alert('æ²’æœ‰ä»»å‹™å¯å‰µå»º');
    return;
  }

  const btn = document.getElementById('createTasksBtn');
  btn.disabled = true;
  btn.textContent = 'å‰µå»ºä¸­...';

  try {
    // é€™è£¡æ‡‰è©²èª¿ç”¨ä¸»æ‡‰ç”¨çš„ä»»å‹™å‰µå»ºå‡½æ•¸
    // ä¾‹å¦‚ï¼šadd() å‡½æ•¸å¾ index.html
    
    let created = 0;
    for (const task of parsedTasks) {
      // æ¨¡æ“¬å‰µå»ºä»»å‹™çš„ JSON çµæ§‹
      console.log(`å‰µå»ºä»»å‹™: ${task.name} (${task.duration}å°æ™‚)`);
      // å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œé€™è£¡æ‡‰è©²èª¿ç”¨ä¸»æ‡‰ç”¨çš„ add() å‡½æ•¸
      // æˆ–è€…ä½¿ç”¨ postMessage æˆ–å…¶ä»– IPC æ©Ÿåˆ¶
      created++;
    }

    alert(`âœ… å·²å»ºç«‹ ${created} å€‹ä»»å‹™ï¼\nï¼ˆæ­¤ç‚ºç¤ºä¾‹ï¼Œå¯¦éš›æ‡‰ç”¨éœ€é›†æˆåˆ°ä¸»æ‡‰ç”¨ï¼‰`);
    
  } catch (error) {
    alert(`âŒ å‰µå»ºå¤±æ•—: ${error.message}`);
  } finally {
    btn.disabled = false;
    btn.textContent = 'âœ… å‰µå»ºæ‰€æœ‰ä»»å‹™';
  }
}

// é‡ç½®è¡¨å–®
function resetForm() {
  document.getElementById('taskDescription').value = '';
  document.getElementById('aiOutput').textContent = 'ï¼ˆç­‰å¾… AI åˆ†æ...ï¼‰';
  document.getElementById('taskList').innerHTML = '<li class="task-item"><p style="color:#888">ï¼ˆåˆ†æå¾Œé¡¯ç¤ºä»»å‹™ï¼‰</p></li>';
  document.getElementById('createTasksBtn').style.display = 'none';
  document.getElementById('status').classList.remove('show');
  parsedTasks = [];
}
</script>

</body>
</html>
